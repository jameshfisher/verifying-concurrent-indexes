<section class='generated_listing' xmlns='http://www.w3.org/1999/xhtml' xmlns:xi='http://www.w3.org/2001/XInclude' xmlns:e='http://eegg.github.com/htmlx' xmlns:m='http://eegg.github.com/macro'><e:displaycode>module bst.removeRoot;

import bst.node;
import bst.remove.removeMax.removeMax;
import bst.remove.removeMax.RemoveMaxRet;


Node* removeRoot(Node* root) {
  Node* o;&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Function precondition.</div><e:pred name="TopOfTree"><code>root</code>, <e:var n="v"/>, <e:st n="S"/></e:pred></div></div>

<div class='section'><pre class='indent'>&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Open <e:pred name="TopOfTree"><code>root</code>, <e:var n="v"/>, <e:st n="S"/></e:pred>.</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><e:var n="l"/>, <e:st n="L"/></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  </e:indent>
</e:exists></div></div>
<e:displaycode>
  if (root.c[0] == null) {&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Assert if-condition.  Substitution.</div><e:exists>
  <e:var n="v"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<code>null</code>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><code>null</code>, <e:st n="L"/></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Lemma: <e:logimpl>
  <e:pred name="Tree"><code>null</code>, <e:st n="S"/></e:pred>
  <e:pred name="EmptyTree"><code>null</code>, <e:st n="S"/></e:pred>
</e:logimpl>.</div><e:exists>
  <e:var n="v"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<code>null</code>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="EmptyTree"><code>null</code>, <e:st n="L"/></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Open <e:pred name="EmptyTree"><code>null</code>, <e:st n="L"/></e:pred>.</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<code>null</code>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <m:hemp/>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:eq><e:st n="L"/><m:scemp/></e:eq>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Use <e:sep><e:predicate>X</e:predicate><m:hemp/></e:sep> = <e:predicate>X</e:predicate>.</div><e:exists>
  <e:var n="v"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
        <code>root</code>
        <e:var n="v"/>,<code>null</code>,<e:var n="r"/>
      </e:fcell>
      <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:eq><e:st n="L"/><m:scemp/></e:eq>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Substitution.</div><e:exists>
  <e:var n="v"/>, <e:var n="r"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
        <code>root</code>
        <e:var n="v"/>,<code>null</code>,<e:var n="r"/>
      </e:fcell>
      <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><m:scemp/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  </e:indent>
</e:exists></div></div>
<e:displaycode>
    o = root.c[1];&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Assignment.</div><e:exists>
  <e:var n="v"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<code>null</code>,<code>o</code>
          </e:fcell>
      <e:pred name="Tree"><code>o</code>, <e:st n="R"/></e:pred>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><m:scemp/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  </e:indent>
</e:exists></div></div>
<e:displaycode>
    delete root;&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Free heap chunk.</div><e:exists>
  <e:st n="R"/>
  
    <e:pred name="Tree"><code>o</code>, <e:st n="R"/></e:pred> ∧
    <e:pred name="TreeCompose"><m:scemp/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Lemma: <e:logimpl>
  <e:pred name="TreeCompose"><m:scemp/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  <e:eq><e:st n="R"/><e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:eq>
</e:logimpl></div><e:exists>
  <e:st n="R"/>
  
    <e:pred name="Tree"><code>o</code>, <e:st n="R"/></e:pred> ∧
    <e:pred name="TreeCompose"><m:scemp/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:eq><e:st n="R"/><e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:eq>
  
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Substitution.  Discard <e:pred name="TreeCompose"><m:scemp/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
and <e:eq><e:st n="R"/><e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:eq>.</div><e:pred name="Tree"><code>o</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>
<e:displaycode>  }
  else {&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Deny if-condition.</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><e:var n="l"/>, <e:st n="L"/></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:noteq><e:var n="l"/><code>null</code></e:noteq>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Lemma: .</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="NonEmptyTree"><e:var n="l"/>, <e:st n="L"/></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  </e:indent>
</e:exists></div></div>
<e:displaycode>
    if (root.c[1] == null) {&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='CommentParagraph'>This branch mostly symmetrical to the previous…</div></div>
<e:displaycode>      o = root.c[0];
      delete root;&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><e:pred name="Tree"><code>o</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>
<e:displaycode>    }
    else {&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Deny if-condition.  Use lemma: .</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="NonEmptyTree"><e:var n="l"/>, <e:st n="L"/></e:pred>
            <e:pred name="NonEmptyTree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
  </e:indent>
</e:exists></div></div>
<e:displaycode>
      RemoveMaxRet r = removeMax(root.c[0]); auto nv = r.max; auto newLeft = r.root;&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Specification of <code>removeMax</code>.</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <e:var n="v"/>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><code>newLeft</code>, <e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus></e:pred>
            <e:pred name="NonEmptyTree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:pred name="Max"><code>nv</code>, <e:st n="L"/></e:pred>
  </e:indent>
</e:exists></div></div>
<e:displaycode>
      root.value = max; root.c[0] = newLeft;&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Assignment.</div><e:exists>
  <e:var n="v"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <code>nv</code>,<code>newLeft</code>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><code>newLeft</code>, <e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus></e:pred>
            <e:pred name="NonEmptyTree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:pred name="Max"><code>nv</code>, <e:st n="L"/></e:pred>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'><m:existsIntro/> on <code>newLeft</code> as <e:var n="l"/>.</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <code>nv</code>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><e:var n="l"/>, <e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus></e:pred>
            <e:pred name="NonEmptyTree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:pred name="Max"><code>nv</code>, <e:st n="L"/></e:pred>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Weakening lemma: .</div><e:exists>
  <e:var n="v"/>, <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <code>nv</code>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><e:var n="l"/>, <e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred> ∧
    <e:pred name="Max"><code>nv</code>, <e:st n="L"/></e:pred>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Lemma: <e:logimpl>
  <e:and>
    <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
    <e:pred name="Max"><code>nv</code>, <e:st n="L"/></e:pred>
  </e:and>
  <e:pred name="TreeCompose"><e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus>, <code>nv</code>, <e:st n="R"/>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred>
</e:logimpl>.<br />
Discard <e:pred name="TreeCompose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred>
and <e:pred name="Max"><code>nv</code>, <e:st n="L"/></e:pred>.</div><e:exists>
  <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <code>nv</code>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><e:var n="l"/>, <e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus>, <code>nv</code>, <e:st n="R"/>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'><m:existsIntro/> on <e:setminus><e:st n="L"/><e:set><code>nv</code></e:set></e:setminus> as <e:st n="L"/>.</div><e:exists>
  <e:var n="l"/>, <e:var n="r"/>, <e:st n="L"/>, <e:st n="R"/>
  <e:indent>
    <e:sep>
      <e:fcell>
            <code>root</code>
            <code>nv</code>,<e:var n="l"/>,<e:var n="r"/>
          </e:fcell>
      <e:sep>
            <e:pred name="Tree"><e:var n="l"/>, <e:st n="L"/></e:pred>
            <e:pred name="Tree"><e:var n="r"/>, <e:st n="R"/></e:pred>
      </e:sep>
    </e:sep> ∧<br />
    <e:pred name="TreeCompose"><e:st n="L"/>, <code>nv</code>, <e:st n="R"/>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred>
  </e:indent>
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Close <e:pred name="TopOfTree"><code>root</code>, <code>nv</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred>.</div><e:pred name="TopOfTree"><code>root</code>, <code>nv</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'><m:existsIntro/> on <code>nv</code> as <e:var n="v"/>.</div><e:exists>
  <e:var n="v"/>
  
    <e:pred name="TopOfTree"><code>root</code>, <e:var n="v"/>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred>
  
</e:exists></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Close <e:pred name="NonEmptyTree"><code>root</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred>.</div><e:pred name="NonEmptyTree"><code>root</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>

<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Weakening</div><e:pred name="Tree"><code>root</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>
<e:displaycode>
      o = root;&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;&#160;&#160;&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>Assignment.</div><e:pred name="Tree"><code>o</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>
<e:displaycode>    }&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>If-rule.</div><e:pred name="Tree"><code>o</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>
<e:displaycode>  }&#160;</e:displaycode>
<div class='section'><pre class='indent'>&#160;&#160;</pre><div class='AssertionParagraph'><div class='expl'>If-rule.  Postcondition.</div><e:pred name="Tree"><code>o</code>, <e:setminus><e:st n="S"/><e:set><e:var n="v"/></e:set></e:setminus></e:pred></div></div>
<e:displaycode>
  return root;
}

&#160;</e:displaycode></section>