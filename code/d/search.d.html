<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <link rel="stylesheet" type="text/css" href="google-code-prettify/prettify.css" />
  <link rel="stylesheet" type="text/css" href="main.css" />
  <script type="text/javascript" src="google-code-prettify/prettify.js"></script>
  <script type="text/javascript">window.onload = function() { prettyPrint(); }</script>
<body>
<pre class="prettyprint">
module bst.search;

import bst.node;

const bool recursive = false;

static if (recursive) {
  bool search(in Node* root, in int value) {
</pre>

<div class="section">
  <pre class="indent">&nbsp;&nbsp;&nbsp;&nbsp;</pre>
  <div class="assertion">
    <div class="expl">Function precondition.</div>
    <span class="pred">Tree</span>(<span class="codevar">root</span>, <span class="set">S</span>)
  </div>
  <div class="clear"></div>
</div>

<pre class="prettyprint">
    bool o;
    if (root) {
</pre>
<div class="section">
  <pre class="indent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</pre>
  <div class="assertion">
    <div class="expl">Assert if-test.</div>
    <span class="pred">Tree</span>(<span class="codevar">root</span>, <span class="set">S</span>) ∧ <span class="codevar">root</span>≠<span class="codevar">null</span>
  </div>
  <div class="clear"></div>
</div>
<pre class="prettyprint">
</pre>
<div class="section">
  <pre class="indent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</pre>
  <div class="assertion">
    <div class="expl">Non-null pointer is non-empty tree (lemma).</div>
    <span class="pred">NonEmptyTree</span>(<span class="codevar">root</span>, <span class="set">S</set>)
  </div>
  <div class="clear"></div>
</div>
<pre class="prettyprint">
</pre>
<div class="section">
  <pre class="indent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</pre>
  <div class="assertion">
    <div class="expl">Open <span class="pred">NonEmptyTree</span>(<span class="codevar">root</span>, <span class="set">S</set>).</div>
    ∃<span class="logicalvar">v</span>,<span class="logicalvar">l</span>,<span class="logicalvar">r</span>,<span class="set">L</span>,<span class="set">R</span>.<br />
    <span class="assertionIndent">&nbsp;&nbsp;</span><span class="codevar">root</span>↦<span class="logicalvar">v</span>,<span class="logicalvar">l</span>,<span class="logicalvar">r</span><br />
    <span class="assertionIndent">&nbsp;&nbsp;</span>∗ <span class="pred">Tree</span>(<span class="logicalvar">l</span>, <span class="set">L</span>)<br />
    <span class="assertionIndent">&nbsp;&nbsp;</span>∗ <span class="pred">Tree</span>(<span class="logicalvar">r</span>, <span class="set">R</span>)<br />
    <span class="assertionIndent">&nbsp;&nbsp;</span>∧ <span class="pred">Compose</span>(<span class="set">L</span>, <span class="logicalvar">v</span>, <span class="set">R</span>, <span class="set">S</span>)<br />
  </div>
  <div class="clear"></div>
</div>
<pre class="prettyprint">
      if (root.value == value) {
        /// ∃v,l,r,L,R.
        ///   n↦v,l,r
        ///   ∗ Tree(l, L)
        ///   ∗ Tree(r, R)
        ///   ∧ Compose(L, v, R, S)
        ///   ∧ v = value

        /// ∃l,r,L,R.
        ///   n↦value,l,r
        ///   ∗ Tree(l, L)
        ///   ∗ Tree(r, R)
        ///   ∧ Compose(L, value, R, S)

        /// value ∈ S

        /// NonEmptyTree(n, S) ∧ value ∈ S

        /// Tree(n, S) ∧ value ∈ S
        o = true;
        /// Tree(n, S) ∧ value ∈ S ∧ o = true

        /// Tree(n, S) ∧ o ↔ (value ∈ S)
      }
      else {
        /// ∃v,l,r,L,R.
        ///   n↦v,l,r
        ///   ∗ Tree(l, L)
        ///   ∗ Tree(r, R)
        ///   ∧ Compose(L, v, R, S)
        ///   ∧ v ≠ value

        o = search(root.c[value > root.value], value);
      }
    }
    else {
      o = false;
    }
    /// Tree(n, S) ∧ o ↔ (value ∈ S)
  }

} else {  // iterative

  bool search(Node* root, in int value) {
    while (root) {
      if (value == root.value) return true;
      else root = root.c[value > root.value];
    }
    assert(!root);
    return false;
  }

}


unittest {
  Node* a = null;
  assert(!search(a, 1));
}

unittest {
  Node* a = new Node(5);
  assert(search(a, 5));
  assert(!search(a, 6));
}

unittest {
  Node* a = new Node(5);
  a.c[0] = new Node(4);
  assert(search(a, 4));
  assert(!search(a, 3));
  assert(!search(a, 6));
}
</pre>

</body>
</html>
