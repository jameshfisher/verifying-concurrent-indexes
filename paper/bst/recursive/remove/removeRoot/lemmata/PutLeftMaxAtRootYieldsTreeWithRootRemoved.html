<section xmlns="http://www.w3.org/1999/xhtml"
	 xmlns:xi="http://www.w3.org/2001/XInclude"
	 xmlns:e="http://eegg.github.com/htmlx"
	 xmlns:m="http://eegg.github.com/macro">

  <h4><e:logimpl>
      <e:fst><e:and>
          <e:fst><e:pred name="Compose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred></e:fst>
          <e:snd><e:pred name="Max"><e:var n="nv"/>, <e:st n="L"/></e:pred></e:snd>
      </e:and></e:fst>
      <e:snd><e:pred name="Compose">
	  <e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="nv"/></e:set></e:snd></e:setminus>,
	  <e:var n="nv"/>, <e:st n="R"/>,
	  <e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>
      </e:pred></e:snd>
  </e:logimpl></h4>

  <p>
    This is used by the <code>removeRoot</code> function
    to show that we can remove the value at the root
    by replacing it with the removed maximum value from the left subtree.
  </p>

  <div class="display"><xi:include href="PutLeftMaxAtRootYieldsTreeWithRootRemoved.svg"/></div>

  <e:derivation>
    <e:step name="given">
      <e:derive><e:and>
          <e:fst><e:pred name="Compose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred></e:fst>
          <e:snd><e:pred name="Max"><e:var n="nv"/>, <e:st n="L"/></e:pred></e:snd>
      </e:and></e:derive>
      <e:by>given</e:by>
    </e:step>

    <e:step name="givenCompose">
      <e:derive><e:pred name="Compose"><e:st n="L"/>, <e:var n="v"/>, <e:st n="R"/>, <e:st n="S"/></e:pred></e:derive>
      <e:by><e:from name="given"/>, <m:andElim/></e:by>
    </e:step>

    <e:step name="givenMax">
      <e:derive><e:pred name="Max"><e:var n="nv"/>, <e:st n="L"/></e:pred></e:derive>
      <e:by><e:from name="given"/>, <m:andElim/></e:by>
    </e:step>

    <e:step name="openCompose">
      <e:derive>
	<e:eq>
	  <e:fst>
	    <e:union>
	      <e:fst><e:st n="L"/></e:fst>
	      <e:snd>
		<e:union>
		  <e:fst><e:set><e:var n="v"/></e:set></e:fst>
		  <e:snd><e:st n="R"/></e:snd>
		</e:union>
	      </e:snd>
	    </e:union>
	  </e:fst>
	  <e:snd><e:st n="S"/></e:snd>
	</e:eq> ∧<br/>
	<e:forall>
	  <e:fst>
	    <e:in><e:fst><e:var n="l"/></e:fst><e:snd><e:st n="L"/></e:snd></e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt><e:fst><e:var n="l"/></e:fst><e:snd><e:var n="v"/></e:snd></e:lt>
	  </e:snd>
	</e:forall> ∧<br/>
	<e:forall>
	  <e:fst>
	    <e:in>
	      <e:fst><e:var n="r"/></e:fst>
	      <e:snd><e:st n="R"/></e:snd>
	    </e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt>
	      <e:fst><e:var n="v"/></e:fst>
	      <e:snd><e:var n="r"/></e:snd>
	    </e:lt>
	  </e:snd>
	</e:forall>
      </e:derive>
      <e:by><e:from name="givenCompose"/>, open predicate</e:by>
    </e:step>

    <e:step name="LUvURIsS">
      <e:derive><e:eq>
	  <e:fst>
	    <e:union>
	      <e:fst><e:st n="L"/></e:fst>
	      <e:snd>
		<e:union>
		  <e:fst><e:set><e:var n="v"/></e:set></e:fst>
		  <e:snd><e:st n="R"/></e:snd>
		</e:union>
	      </e:snd>
	    </e:union>
	  </e:fst>
	  <e:snd><e:st n="S"/></e:snd>
      </e:eq></e:derive>
      <e:by><e:from name="openCompose"/>, <m:andElim/></e:by>
    </e:step>

    <e:step name="AllInLltv">
      <e:derive><e:forall>
	  <e:fst>
	    <e:in><e:fst><e:var n="l"/></e:fst><e:snd><e:st n="L"/></e:snd></e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt><e:fst><e:var n="l"/></e:fst><e:snd><e:var n="v"/></e:snd></e:lt>
	  </e:snd>
      </e:forall></e:derive>
      <e:by><e:from name="openCompose"/>, <m:andElim/></e:by>
    </e:step>

    <e:step name="AllInRGreaterThanv">
      <e:derive><e:forall>
	  <e:fst>
	    <e:in>
	      <e:fst><e:var n="r"/></e:fst>
	      <e:snd><e:st n="R"/></e:snd>
	    </e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt>
	      <e:fst><e:var n="v"/></e:fst>
	      <e:snd><e:var n="r"/></e:snd>
	    </e:lt>
	  </e:snd>
      </e:forall></e:derive>
      <e:by><e:from name="openCompose"/>, <m:andElim/></e:by>
    </e:step>

    <e:step name="subtractv">
      <e:derive><e:eq>
	  <e:fst><e:setminus>
	    <e:fst>(<e:union>
	      <e:fst><e:st n="L"/></e:fst>
	      <e:snd>
		<e:union>
		  <e:fst><e:set><e:var n="v"/></e:set></e:fst>
		  <e:snd><e:st n="R"/></e:snd>
		</e:union>
	      </e:snd>
	      </e:union>)</e:fst>
	    <e:snd><e:set><e:var n="v"/></e:set></e:snd>
	  </e:setminus></e:fst>
	  <e:snd><e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus></e:snd>
      </e:eq></e:derive>
      <e:by><e:from name="LUvURIsS"/>, <m:sameOp/></e:by>
    </e:step>

    <e:step name="distribSetminus">
      <e:derive><e:eq>
	  <e:fst><e:union>
	      <e:fst>(<e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>)</e:fst>
	      <e:snd>
		<e:union>
		  <e:fst>(<e:setminus><e:fst><e:set><e:var n="v"/></e:set></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>)</e:fst>
		  <e:snd>(<e:setminus><e:fst><e:st n="R"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>)</e:snd>
		</e:union>
	      </e:snd>
	  </e:union></e:fst>
	  <e:snd><e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus></e:snd>
      </e:eq></e:derive>
      <e:by><e:from name="subtractv"/>, <m:distribSetminusUnion/></e:by>
    </e:step>

    <e:step name="LMinusvUnionRMinusvIsSMinusv">
      <e:derive><e:eq>
	  <e:fst><e:union>
	      <e:fst>(<e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>)</e:fst>
	      <e:snd>(<e:setminus><e:fst><e:st n="R"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>)</e:snd>
	  </e:union></e:fst>
	  <e:snd><e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus></e:snd>
      </e:eq></e:derive>
      <e:by><e:from name="distribSetminus"/>, <m:SetMinusSetIsEmpty/></e:by>
    </e:step>

    <e:step name="LminusvIsL">
      <e:derive><e:eq>
	  <e:fst><e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus></e:fst>
	  <e:snd><e:st n="L"/></e:snd>
      </e:eq></e:derive>
      <e:by>??</e:by>
    </e:step>

    <e:step name="RminusvIsR">
      <e:derive><e:eq>
	  <e:fst><e:setminus><e:fst><e:st n="R"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus></e:fst>
	  <e:snd><e:st n="R"/></e:snd>
      </e:eq></e:derive>
      <e:by>??</e:by>
    </e:step>

    <e:step name="LURIsSMinusv">
      <e:derive><e:eq>
	  <e:fst><e:union>
	      <e:fst><e:st n="L"/></e:fst>
	      <e:snd><e:st n="R"/></e:snd>
	  </e:union></e:fst>
	  <e:snd><e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus></e:snd>
      </e:eq></e:derive>
      <e:by><e:from name="LMinusvUnionRMinusvIsSMinusv"/>, <e:from name="LminusvIsL"/>, <e:from name="RminusvIsR"/>, substitution</e:by>
    </e:step>

    <e:step name="LminusnvUnionnvIsL">
      <e:derive><e:eq>
	  <e:fst><e:union>
	      <e:fst>(<e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="nv"/></e:set></e:snd></e:setminus>)</e:fst>
	      <e:snd><e:set><e:var n="nv"/></e:set></e:snd>
	  </e:union></e:fst>
	  <e:snd><e:st n="L"/></e:snd>
      </e:eq></e:derive>
      <e:by>??</e:by>
    </e:step>

    <e:step name="newUnion">
      <e:derive><e:eq>
	  <e:fst>
	    <e:union>
	      <e:fst>(<e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="nv"/></e:set></e:snd></e:setminus>)</e:fst>
	      <e:snd>
		<e:union>
		  <e:fst><e:set><e:var n="nv"/></e:set></e:fst>
		  <e:snd><e:st n="R"/></e:snd>
		</e:union>
	      </e:snd>
	    </e:union>
	  </e:fst>
	  <e:snd>(<e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>)</e:snd>
      </e:eq></e:derive>
      <e:by><e:from name="LURIsSMinusv"/>, <e:from name="LminusnvUnionnvIsL"/>, substitution</e:by>
    </e:step>

    <e:step name="AllInLMinusnvLessThannv">
      <e:derive><e:forall>
	  <e:fst>
	    <e:in><e:fst><e:var n="l"/></e:fst><e:snd>(<e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="nv"/></e:set></e:snd></e:setminus>)</e:snd></e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt><e:fst><e:var n="l"/></e:fst><e:snd><e:var n="nv"/></e:snd></e:lt>
	  </e:snd>
      </e:forall></e:derive>
      <e:by>???</e:by>
    </e:step>

    <e:step name="AllInRGreaterThannv">
      <e:derive><e:forall>
	  <e:fst>
	    <e:in>
	      <e:fst><e:var n="r"/></e:fst>
	      <e:snd><e:st n="R"/></e:snd>
	    </e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt>
	      <e:fst><e:var n="nv"/></e:fst>
	      <e:snd><e:var n="r"/></e:snd>
	    </e:lt>
	  </e:snd>
      </e:forall></e:derive>
      <e:by>???</e:by>
    </e:step>

    <e:step name="composeParts">
      <e:derive>
	<e:eq>
	  <e:fst>
	    <e:union>
	      <e:fst>(<e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="nv"/></e:set></e:snd></e:setminus>)</e:fst>
	      <e:snd>
		<e:union>
		  <e:fst><e:set><e:var n="nv"/></e:set></e:fst>
		  <e:snd><e:st n="R"/></e:snd>
		</e:union>
	      </e:snd>
	    </e:union>
	  </e:fst>
	  <e:snd>(<e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>)</e:snd>
	</e:eq> ∧<br/>
	<e:forall>
	  <e:fst>
	    <e:in><e:fst><e:var n="l"/></e:fst><e:snd>(<e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="nv"/></e:set></e:snd></e:setminus>)</e:snd></e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt><e:fst><e:var n="l"/></e:fst><e:snd><e:var n="nv"/></e:snd></e:lt>
	  </e:snd>
	</e:forall> ∧<br/>
	<e:forall>
	  <e:fst>
	    <e:in>
	      <e:fst><e:var n="r"/></e:fst>
	      <e:snd><e:st n="R"/></e:snd>
	    </e:in>
	  </e:fst>
	  <e:snd>
	    <e:lt>
	      <e:fst><e:var n="nv"/></e:fst>
	      <e:snd><e:var n="r"/></e:snd>
	    </e:lt>
	  </e:snd>
	</e:forall>
      </e:derive>
      <e:by><e:from name="newUnion"/>, <e:from name="AllInLMinusnvLessThannv"/>, <e:from name="AllInRGreaterThannv"/>, <m:andIntro/></e:by>
    </e:step>

    <e:step name="qed">
      <e:derive><e:pred name="Compose">
	  <e:setminus><e:fst><e:st n="L"/></e:fst><e:snd><e:set><e:var n="nv"/></e:set></e:snd></e:setminus>,
	  <e:var n="nv"/>, <e:st n="R"/>,
	  <e:setminus><e:fst><e:st n="S"/></e:fst><e:snd><e:set><e:var n="v"/></e:set></e:snd></e:setminus>
      </e:pred></e:derive>
      <e:by>??</e:by>
    </e:step>
  </e:derivation>
</section>
