<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:e="http://eegg.github.com/htmlx" xmlns:m="http://eegg.github.com/macro">
  <head>
    <meta charset="utf-8"/>

    <link rel="stylesheet" type="text/css" href="http://eegg.github.com/style/css/common.css"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>

    <link rel="stylesheet" type="text/css" href="css/google-code-prettify/prettify.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>

    <script type="text/javascript" src="css/google-code-prettify/prettify.js"> </script>
    <script type="text/javascript">window.addEventListener("load", function() { prettyPrint(); });</script>

    <title>Verifying concurrent indexes</title>
  </head>
  <body>
    <section class="content">
      <hgroup>
	<h1>Verifying concurrent indexes</h1>
      </hgroup>

      <table>
	<tbody>
	  <tr>
	    <th>Name</th>
	    <td>James Fisher</td>
	  </tr>
	</tbody>
      </table>

      <section xml:base="introduction/introduction.html">
  <h2>Introduction</h2>

  <section>
  <h3>What is an index?</h3>

  An index<span class="note">The same data type also goes by the names <em>map</em>, <em>dictionary</em>, <em>associative array</em>, <em>table</em>, and <em>hash</em>.</span> stores values,
  where each value has a distinct name.
  Many data sets fit this description.
  For example, a contact list stores <em>phone numbers</em>, where each number is accessed with (indexed by) a person's <em>name</em>.
  The Web can be modeled as a store of <em>pages</em>, where each page is indexed by a <abbr title="Uniform Resource Locator" class="smallcaps">URL</abbr>.
  More abstractly, an index defines a function from some <em>range</em> to some <em>domain</em>.

  <section xml:base="what_is_an_index/the_index_api.html">

  <h4>The index <abbr title="Application Programming Interface" class="smallcaps">API</abbr></h4>

  <p>
    As a fundamental data type, almost every programming language has an index implementation.<span class="note">wp_mapping</span>
    <!--(Indeed, in some languages, such as Javascript,
    all objects are indexes.<e:cite>ecmascript, p.\ 2.</e:cite>)-->
    With it,
    the programmer can memoize the results of a function,
    model the houses on her street,
    or describe a directed graph.
    Here is pseudocode for a web cache:<span class="note">I use a syntax similar to C++ in my examples.</span>

    <pre class="prettyprint">Index&lt;Url, Page&gt; cache;  // `cache` stores webpages previously accessed.

Page get(Url u) {  // return the webpage at the URL `u`.
  Page p = cache.search(u);  // First look in the cache ...

  if (p != null &amp;&amp; !p.expired())
    // if the cache has an entry for this URL and it has not expired,
    return p;  // just return that.

  p = http_get(u);  // Otherwise, fetch the page from the Web.

  if (p == null) cache.remove(u);  // If the page doesn't exist, remove our records of it,
  else           cache.insert(u, p);  // otherwise cache it for future requests.

  return p;
}
</pre>
  </p>

  <p>
    This small example illustrates the entire <abbr>API</abbr>.
    Notice that the <code>Index</code> is an <q>abstract</q>, or <q>container</q> data type:
    we must supply the types of the keys and the values
    (in the above, the keys are <code>Url</code>s and the values are <code>Page</code>s).
    The resulting <q>concrete</q> data type can then be instantiated.
    The instantiated index <code>cache</code> has three operations that can be performed on it:
    <code>search</code>, <code>insert</code> and <code>remove</code>.
    For an index <code>i</code>
    that maps keys of type <code>K</code> onto  values of type <code>V</code>,
    these operations do the following:
  </p>

  <ul>
    <li><strong class="item"><code>value = i.search(key)</code></strong>
	If there is a value associated with <code>key</code> in <code>i</code>,
	<code>value</code> will be that value.
	Otherwise, <code>value</code> will be <code>null</code>.
	<!--The <code>search</code> function is also called <code>find</code>, <code>fetch</code>, <code>read</code>, and <code>get</code>.-->
      </li>
    <li><strong class="item">
	<code>i.insert(key, value)</code>
      </strong>
	Subsequent calls to <code>i.search(key)</code> will return <code>value</code>,
	until a subsequent call to <code>i.insert(k, —)</code> or <code>i.remove(k)</code>,
	where <code>k == key</code>.
	<!--The <code>insert</code> function is also called <code>store</code>, <code>set</code>, <code>save</code>, and <code>add</code>.-->
      </li>
    <li><strong class="item">
	<code>i.remove(key)</code>
      </strong>
	Subsequent calls to <code>i.search(key)</code> will return <code>null</code>,
	until subsequent calls to <code>i.insert(k, —)</code> or <code>i.remove(k)</code>,
	where <code>k == key</code>.
	<!--The <code>remove</code> function is also called <code>delete</code>.
	    It may also be absent,
	    in favour of <code>insert(k, null)</code>
	    (suggesting the <q>total function</q> interpretation).-->
      </li>
  </ul>

</section>
  <!--<xi:include href="what_is_an_index/formalizing_behavior_a_set_adt.html" />
  <xi:include href="what_is_an_index/formalizing_index_behavior.html" />-->
</section>
  <!--<xi:include href="index_algorithms.html" />
  <xi:include href="indexes_in_the_wild.html" />
  <xi:include href="some_predicate_definitions.html" />-->
</section>
      <!-- <xi:include href="ll/ll.html" /> -->
      <section xml:base="bst/bst.html">
  
  <h2>Verifying the <abbr title="Binary Search Tree" class="smallcaps">BST</abbr></h2>

  <p>
    The second data structure I address in this project is the <abbr title="Binary Search Tree" class="smallcaps">BST</abbr>.
    As before, I begin with a description of the data structure, then
    verify recursive algorithms for <code>search</code>, <code>insert</code>, and <code>remove</code>.
  </p>

  <section xml:base="data/data.html">
  
  <h3>The <abbr title="Binary Search Tree" class="smallcaps">BST</abbr> data structure</h3>

  <p>
    At each <code>Node</code> of an <abbr title="Linked List" class="smallcaps">LL</abbr>,
    we had a link to a smaller <abbr title="Linked List" class="smallcaps">LL</abbr>:
    the data structure contained a single smaller version of itself.
    The sole difference that the binary tree introduces is that
    it contains <em>two</em> smaller binary trees.
    In the <abbr title="Linked List" class="smallcaps">LL</abbr>, the set was split into
    the element <span class="var">v</span> at the <code>head</code> node and the set <span class="st">T</span> held in the <code>tail</code> list.
    In the binary tree, the same set is split into
    an element <span class="var">v</span> at the <code>root</code> node (analogous to the <code>head</code> node in the <abbr title="Linked List" class="smallcaps">LL</abbr>),
    and <em>two</em> sets <span class="st">L</span> and <span class="st">R</span>,
    held respectively in what are called the <code>left</code> and <code>right</code> subtrees.
  </p>

  <p>
    In our <abbr title="Linked List" class="smallcaps">LL</abbr>, we chose to order the elements of the set <span class="st">S</span> in strictly ascending order;
    that is, the element <span class="var">v</span> was chosen as the minimal element of <span class="st">S</span>.
    Such an ordered linked list might be termed a <em>Linked Search List</em>.
    Similarly, we can order the elements of the binary tree.
    Here, the choice of <span class="var">v</span> from <span class="st">S</span> is arbitrary.
    The set <span class="st">L</span> is then chosen to hold all elements of <span class="st">S</span> that are strictly less than <span class="var">v</span>,
    and the set <span class="st">R</span> holds all elements strictly greater than <span class="var">v</span>.
    This particular type of binary tree with its elements ordered is called a <em>Binary Search Tree</em>,
    which I will hereon abbreviate as <abbr title="Binary Search Tree" class="smallcaps">BST</abbr>.
  </p>

  <p>
    As with the <abbr title="Linked List" class="smallcaps">LL</abbr>, a pointer into the <code>root</code> node is required to complete the representation of the set.
    Also as with the <abbr title="Linked List" class="smallcaps">LL</abbr>, ∅ has a distinct representation: a pointer to <code>null</code> and no allocated heap chunks.
  </p>

  <p>
    We described a general pointer <code>head</code> into a list representing the set <span class="st">S</span>
    with the predicate <span class="pred_name">List</span>(<code>head</code>, <span class="st">S</span>).
    Similarly, we will now describe a general pointer <code>root</code> into a <abbr title="Binary Search Tree" class="smallcaps">BST</abbr> representing <span class="st">S</span>
    with a predicate <span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>).
  </p>

  <p>
    Where the two representations defined by the <abbr title="Linked List" class="smallcaps">LL</abbr> were termed <span class="pred_name">EmptyList</span> and <span class="pred_name">NonEmptyList</span>,
    we will analogously define <span class="pred_name">EmptyTree</span> and <span class="pred_name">NonEmptyTree</span>.
    As with our visualization of the <abbr title="Linked List" class="smallcaps">LL</abbr>, we can view the <abbr title="Binary Search Tree" class="smallcaps">BST</abbr> predicates graphically:

    <div class="display">
      <!-- Created with Inkscape (http://www.inkscape.org/) --><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="407.48032" height="274.60629" id="svg2" version="1.1" inkscape:version="0.48.1 r9760" sodipodi:docname="predicates.svg">
  <defs id="defs4">
    <marker inkscape:stockid="SquareM" orient="auto" refY="0" refX="0" id="SquareM" style="overflow:visible">
      <path id="path5430" d="M -5,-5 -5,5 5,5 5,-5 -5,-5 z" style="fill-rule:evenodd;stroke:#000000;stroke-width:1pt;marker-start:none" transform="scale(0.4,0.4)" inkscape:connector-curvature="0"/>
    </marker>
    <marker inkscape:stockid="Arrow1Mend" orient="auto" refY="0" refX="0" id="Arrow1Mend" style="overflow:visible">
      <path id="path4781" d="M 0,0 5,-5 -12.5,0 5,5 0,0 z" style="fill-rule:evenodd;stroke:#000000;stroke-width:1pt;marker-start:none" transform="matrix(-0.4,0,0,-0.4,-4,0)" inkscape:connector-curvature="0"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mstart" orient="auto" refY="0" refX="0" id="Arrow2Mstart" style="overflow:visible">
      <path id="path4796" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(0.6,0.6)" inkscape:connector-curvature="0"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="Arrow2Mend" style="overflow:visible">
      <path id="path4799" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)" inkscape:connector-curvature="0"/>
    </marker>
    <marker inkscape:stockid="Arrow2Lend" orient="auto" refY="0" refX="0" id="Arrow2Lend" style="overflow:visible">
      <path id="path4793" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="matrix(-1.1,0,0,-1.1,-1.1,0)" inkscape:connector-curvature="0"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="Arrow2Mend-7" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4799-3" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="Arrow2Mend-7-6" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4799-3-9" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="Arrow2Mend-9" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4799-2" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="Arrow2Mend-9-9" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4799-2-1" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="marker4310" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4312" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="marker4314" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4316" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="Arrow2Mend-9-9-7" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4799-2-1-7" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="marker4499" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4501" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
    <marker inkscape:stockid="Arrow2Mend" orient="auto" refY="0" refX="0" id="marker4503" style="overflow:visible">
      <path inkscape:connector-curvature="0" id="path4505" style="font-size:12px;fill-rule:evenodd;stroke-width:0.625;stroke-linejoin:round" d="M 8.7185878,4.0337352 -2.2072895,0.01601326 8.7185884,-4.0017078 c -1.7454984,2.3720609 -1.7354408,5.6174519 -6e-7,8.035443 z" transform="scale(-0.6,-0.6)"/>
    </marker>
  </defs>
  <sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.979899" inkscape:cx="128.39798" inkscape:cy="170.80151" inkscape:document-units="mm" inkscape:current-layer="layer1" showgrid="true" inkscape:window-width="1920" inkscape:window-height="1032" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" units="mm" inkscape:snap-global="true" showguides="true" inkscape:guide-bbox="true" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0">
    <inkscape:grid type="xygrid" id="grid3012" empspacing="5" visible="true" enabled="true" snapvisiblegridlinesonly="true" units="mm" spacingx="2.5mm" spacingy="2.5mm"/>
  </sodipodi:namedview>
  <metadata id="metadata7">
    <rdf:RDF>
      <cc:Work rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>
        <dc:title/>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(177.16534,-361.41728)">
    <rect style="fill:none;stroke:none" id="rect5268" width="788.3858" height="106.29922" x="-354.33072" y="379.13382"/>
    <text xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" x="248.03149" y="453.99994" id="text6078" sodipodi:linespacing="125%"><tspan sodipodi:role="line" id="tspan6080" x="248.03149" y="453.99994" style="font-size:10.5px;font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro"/></text>
    <g id="g6344" transform="translate(17.716533,-6.7044861e-6)">
      <g style="fill:#000000;fill-opacity:0.90980392" id="g6290">
        <path sodipodi:nodetypes="cc" inkscape:connector-curvature="0" d="m 150.59057,423.42516 0,26.5748" style="fill:#000000;fill-opacity:0.90980392;stroke:#000000;stroke-width:0.99921262;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:0.90980392;stroke-dasharray:none;marker-end:url(#SquareM)" id="path6062"/>
        <text sodipodi:linespacing="125%" id="text6082" y="419.42517" x="150.59056" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:0.90980392;stroke:none;font-family:Sans" xml:space="preserve"><tspan style="font-size:10.5px;font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:0.90980392;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="419.42517" x="150.59056" id="tspan6084" sodipodi:role="line">root</tspan></text>
      </g>
      <text xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" x="150.59056" y="574.01569" id="text5888-7" sodipodi:linespacing="125%"><tspan id="tspan6022-9" sodipodi:role="line" x="150.59056" y="574.01569" style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;font-family:Minion Pro;-inkscape-font-specification:Minion Pro">EmptyTree(<tspan style="font-style:italic" id="tspan4684">root</tspan>, <tspan style="font-weight:bold" id="tspan3050">S</tspan>),</tspan><tspan sodipodi:role="line" x="150.59056" y="589.65497" style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" id="tspan6383">where <tspan style="font-weight:bold" id="tspan3052">S</tspan> = ∅.</tspan></text>
    </g>
    <text xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" x="35.433075" y="379.13379" id="text5888-7-8" sodipodi:linespacing="125%"><tspan id="tspan6022-9-4" sodipodi:role="line" x="35.433075" y="379.13379" style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;font-family:Minion Pro;-inkscape-font-specification:Minion Pro">Tree(<tspan style="font-style:italic" id="tspan4485">root</tspan>, <tspan style="font-weight:bold" id="tspan3048">S</tspan>)</tspan></text>
    <path style="font-size:438.40066528px;font-style:normal;font-weight:normal;line-height:125%;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" d="m 210.82102,400 c 0,-3.29679 -0.75752,-6.05553 -7.08086,-6.05553 -3.51297,0.054 -164.72268,0.48926 -168.235653,0.48926 -1.891594,0 -4.325669,-2.16348 -4.649941,-6.97354 l -1.837634,0 c -0.324272,4.81006 -2.754601,6.97354 -4.592149,6.97354 -3.350832,-0.054 -179.779143,-0.48926 -183.724483,-0.48926 -6.2693,0 -6.91905,2.75874 -6.91905,6.05553 l 1.7837,0 c 0.54045,-4.05342 2.59532,-4.54207 5.08142,-4.54207 3.29678,0 179.24035,0.75894 182.915454,0.75894 2.972514,0 5.565386,-1.29945 6.267986,-4.48814 l 0.215738,0 c 0.756637,3.18869 3.295463,4.48814 6.267976,4.48814 3.512973,0 164.399306,-0.75894 167.804176,-0.75894 2.37801,0 4.37916,0.48865 4.91962,4.54207 z" id="path6395" inkscape:connector-curvature="0" sodipodi:nodetypes="ccscccsccssccsscc"/>
    <g transform="translate(-415.8073,318.37587)" id="g3889-5">
      <g id="g5417" transform="translate(88.582671,88.582684)">
        <path inkscape:connector-curvature="0" id="path3812-4" d="m 274.07504,25.324863 -53.14961,0 -62.00787,124.015747 177.16535,0 z" style="fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" sodipodi:nodetypes="ccccc"/>
        <text sodipodi:linespacing="125%" id="text3389-5" y="167.05714" x="247.50023" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" xml:space="preserve"><tspan style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="167.05714" x="247.50023" id="tspan3391-35" sodipodi:role="line">NonEmptyTree(<tspan style="font-style:italic" id="tspan4650">root</tspan>, <tspan id="tspan3395-4" style="font-weight:bold">S</tspan>),</tspan><tspan style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="182.69644" x="247.50023" sodipodi:role="line" id="tspan4652">where <tspan style="font-weight:bold" id="tspan4654">S</tspan> = <tspan style="font-weight:bold" id="tspan4656">L</tspan> ∪ {<tspan style="font-style:italic" id="tspan4658">v</tspan>} ∪ <tspan style="font-weight:bold" id="tspan4660">R</tspan>,</tspan><tspan style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="198.33575" x="247.50023" sodipodi:role="line" id="tspan4662">∀ <tspan style="font-style:italic" id="tspan4664">l</tspan>∈<tspan style="font-weight:bold" id="tspan4666">L</tspan>.  <tspan style="font-style:italic" id="tspan4670">l</tspan> &lt; <tspan style="font-style:italic" id="tspan4672">v</tspan>, and</tspan><tspan style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="213.97505" x="247.50023" sodipodi:role="line" id="tspan4674">∀ <tspan style="font-style:italic" id="tspan4682">r</tspan>∈<tspan style="font-weight:bold" id="tspan4680">R</tspan>.  <tspan style="font-style:italic" id="tspan4678">v</tspan> &lt; <tspan style="font-style:italic" id="tspan4676">r</tspan>.</tspan><tspan style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="229.61436" x="247.50023" sodipodi:role="line" id="tspan4668"/></text>
        <g id="g6184">
          <path style="fill:none;stroke:#000000;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" d="m 229.7837,43.041398 -8.85827,17.716536 -8.85827,17.716535 70.86615,0 -8.85827,-17.716535 -8.85827,-17.716536 z" id="path6167" inkscape:connector-curvature="0" sodipodi:nodetypes="ccccccc"/>
          <text xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#663e00;fill-opacity:1;stroke:none;font-family:Sans" x="231.78369" y="71.616211" id="text6124" sodipodi:linespacing="125%"><tspan sodipodi:role="line" id="tspan6126" x="231.78369" y="71.616211" style="font-size:10.5px;font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;fill:#663e00;fill-opacity:1;font-family:Minion Pro;-inkscape-font-specification:Minion Pro">left</tspan></text>
          <text sodipodi:linespacing="125%" id="text6159" y="53.899654" x="247.50023" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" xml:space="preserve"><tspan style="font-size:10.5px;font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="53.899654" x="247.50023" id="tspan6161" sodipodi:role="line">v</tspan></text>
          <text sodipodi:linespacing="125%" id="text6163" y="71.616211" x="263.21677" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#5c7700;fill-opacity:1;stroke:none;font-family:Sans" xml:space="preserve"><tspan style="font-size:10.5px;font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;fill:#5c7700;fill-opacity:1;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="71.616211" x="263.21677" id="tspan6165" sodipodi:role="line">right</tspan></text>
          <path style="fill:none;stroke:#000000;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" d="m 274.07504,60.757934 -53.14961,0" id="path6169" inkscape:connector-curvature="0" sodipodi:nodetypes="cc"/>
          <path style="fill:none;stroke:#000000;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" d="m 247.50024,78.474469 0,-17.71653" id="path6171" inkscape:connector-curvature="0" sodipodi:nodetypes="cc"/>
        </g>
      </g>
      <text sodipodi:linespacing="125%" id="text3820-5-0" y="101.04928" x="336.08292" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" xml:space="preserve"><tspan style="font-size:10.5px;font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="101.04928" x="336.08292" id="tspan3822-6-81" sodipodi:role="line">root</tspan></text>
      <g id="g5427" transform="translate(26.574803,17.716535)">
        <g id="g5397" transform="translate(-54.212135,-16.673117)">
          <path inkscape:connector-curvature="0" id="path5399" d="m 319.4289,183.73027 -17.71653,35.43307 35.43307,0 z" style="fill:#ffffff;fill-opacity:1;stroke:#663e00;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" sodipodi:nodetypes="cccc"/>
          <text sodipodi:linespacing="125%" id="text5401" y="209.73633" x="319.4155" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" xml:space="preserve"><tspan style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="209.73633" x="319.4155" id="tspan5403" sodipodi:role="line">L</tspan></text>
        </g>
        <text xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" x="265.20337" y="213.9136" id="text5405" sodipodi:linespacing="125%"><tspan sodipodi:role="line" id="tspan5407" x="265.20337" y="213.9136" style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro">Tree(<tspan id="tspan5415" style="font-style:italic">left</tspan>, <tspan id="tspan5413" style="font-weight:bold">L</tspan>)</tspan></text>
      </g>
      <g id="g5437" transform="translate(115.15748,17.716535)">
        <g transform="translate(-54.212135,-16.673117)" id="g5439">
          <path sodipodi:nodetypes="cccc" style="fill:#ffffff;fill-opacity:1;stroke:#5c7700;stroke-width:1.77165353;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" d="m 319.4289,183.73027 -17.71653,35.43307 35.43307,0 z" id="path5441" inkscape:connector-curvature="0"/>
          <text xml:space="preserve" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" x="319.4155" y="209.73633" id="text5443" sodipodi:linespacing="125%"><tspan sodipodi:role="line" id="tspan5445" x="319.4155" y="209.73633" style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro">R</tspan></text>
        </g>
        <text sodipodi:linespacing="125%" id="text5447" y="213.9136" x="265.20337" style="font-size:40px;font-style:normal;font-weight:normal;text-align:center;line-height:125%;letter-spacing:0px;word-spacing:0px;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;font-family:Sans" xml:space="preserve"><tspan style="font-size:10.5px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:center;text-anchor:middle;font-family:Minion Pro;-inkscape-font-specification:Minion Pro" y="213.9136" x="265.20337" id="tspan5449" sodipodi:role="line">Tree(<tspan style="font-style:italic" id="tspan5451">right</tspan>, <tspan style="font-weight:bold" id="tspan5453">R</tspan>)</tspan></text>
      </g>
      <path sodipodi:nodetypes="cc" style="fill:none;stroke:#000000;stroke-width:1.0629921;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1.06299213, 1.06299213;stroke-dashoffset:0;marker-end:url(#Arrow2Mend-9-9)" d="m 371.51598,167.05715 8.85827,17.71654" id="path6195" inkscape:connector-curvature="0"/>
      <path sodipodi:nodetypes="cc" style="fill:none;stroke:#000000;stroke-width:1.0629921;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0;marker-end:url(#Arrow2Mend-9-9)" d="m 336.08291,105.04928 0,26.5748" id="path6197" inkscape:connector-curvature="0"/>
      <path inkscape:connector-curvature="0" id="path6829" d="m 300.64984,167.05715 -8.85827,17.71654" style="fill:none;stroke:#000000;stroke-width:1.0629921;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:1.06299213, 1.06299213;stroke-dashoffset:0;marker-end:url(#Arrow2Mend-9-9)" sodipodi:nodetypes="cc"/>
    </g>
  </g>
</svg>
    </div>
  </p>

  <p>
    The <span class="pred_name">Tree</span> predicate is defined in terms of the two concrete representations:

    <div class="displaymath">
      <span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>) ≝ <span class="pred_name">EmptyTree</span>(<code>root</code>, <span class="st">S</span>) ∨ <span class="pred_name">NonEmptyTree</span>(<code>root</code>, <span class="st">S</span>).
    </div>
  </p>

  <p>
    The <span class="pred_name">EmptyTree</span> predicate is in fact just <span class="pred_name">EmptyList</span> under a new name:

    <table class="displaymath">
      <tbody>
	<tr>
	  <td><span class="pred_name">EmptyTree</span>(<span class="var">n</span>, <span class="var">S</span>) ≝</td>
	  <td><span class="var">n</span> = <code>null</code> ∧</td>
	  <td>An empty tree is indicated by a null pointer, </td>
	</tr>
	<tr>
	  <td/>
	  <td><b>emp</b> ∧</td>
	  <td>uses no space on the heap, and</td>
	</tr>
	<tr>
	  <td/>
	  <td><span class="var">S</span> = ∅.</td>
	  <td>represents the empty set.</td>
	</tr>
      </tbody>
    </table>
  </p>

  <p>
    To describe the <span class="pred_name">NonEmptyTree</span>,
    we first define the ordering of its elements.
    We need a new <abbr title="Binary Search Tree" class="smallcaps">BST</abbr> <span class="pred_name">Compose</span> predicate
    on the total set <span class="st">S</span>, the root element <span class="var">v</span>, and the subsets <span class="st">L</span> and <span class="st">R</span>:

    <table class="displaymath">
      <tbody>
	<tr>
	  <td><span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>) ≝</td>
	  <td>
	    
	      <span class="st">L</span> ∪ 
		  {<span class="var">v</span>} ∪ <span class="st">R</span>
		
	       = <span class="st">S</span> ∧
	  </td>
	  <td><span class="st">L</span>, <span class="var">v</span>, and <span class="st">R</span> make up the set <span class="st">S</span>,</td>
	</tr>
	<tr>
	  <td/>
	  <td>
	    ∀
		<span class="var">l</span> ∈ <span class="st">L</span>
	      . 
		<span class="var">l</span> &lt; <span class="var">v</span>
	       ∧
	  </td>
	  <td>all values in <span class="st">L</span> are less than <span class="var">v</span>, and</td>
	</tr>
	<tr>
	  <td/>
	  <td>
	    ∀
		<span class="var">r</span> ∈ <span class="st">R</span>
	      . 
		<span class="var">v</span> &lt; <span class="var">r</span>
	      .
	  </td>
	  <td>all values in <span class="st">R</span> are greater than <span class="var">v</span>.</td>
	</tr>
      </tbody>
    </table>
  </p>

  <p>
    Using our <span class="pred_name">Compose</span> predicate,
    we can describe a tree at address <code>root</code>
    that stores the value <span class="var">v</span> at the root and represents the set <span class="st">S</span>.
    We define an intermediary predicate, <span class="pred_name">TopOfTree</span>:

    <table class="displaymath">
      <tbody>
	<tr>
	  <td><span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ≝</td>
	  <td>∃<span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>.</td>
	  <td/>
	</tr>
	<tr>
	  <td/>
	  <td>
	    <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span>
	  </td>
	  <td><code>root</code> points to a <code>Node</code> with value <span class="var">v</span> and pointers <span class="var">l</span> and <span class="var">r</span></td>
	</tr>
	<tr>
	  <td/>
	  <td>∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>)</td>
	  <td>where <span class="var">l</span> points into a <abbr title="Binary Search Tree" class="smallcaps">BST</abbr> representing <span class="st">L</span>,</td>
	</tr>
	<tr>
	  <td/>
	  <td>∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>)</td>
	  <td><span class="var">r</span> points into a <abbr title="Binary Search Tree" class="smallcaps">BST</abbr> representing <span class="st">R</span>, and</td>
	</tr>
	<tr>
	  <td/>
	  <td>∧ <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>).</td>
	  <td>the values in the tree are totally ordered.</td>
	</tr>
      </tbody>
    </table>
  </p>

  <p>
    The <span class="pred_name">TopOfTree</span> predicate allows us to gradually expand our knowledge of the tree as an algorithm proceeds.
    Before we know the value at the root, though, we just know it's non-empty:

    <table class="displaymath">
      <tbody>
	<tr>
	  <td><span class="pred_name">NonEmptyTree</span>(<code>root</code>, <span class="st">S</span>) ≝</td>
	  <td>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>)</td>
	</tr>
      </tbody>
    </table>
  </p>

  <p>
    Here is the module defining the structure of a node in the tree:

    <div class="display">
      <section class="generated_listing" xml:base="../../../code/d/html/bst/node.d.html"><pre class="prettyprint">module bst.node;

struct Node {
  int value;   // One value in the set held in this subtree
  Node*[2] c;  // Pointers to the two subtrees (0 is left, 1 is right)

  this(int value) {
    this.value = value;  // The subtree pointers are initialized to null.
  }
} </pre></section>
    </div>
  </p>

  <p>
    Notice the use of a <q>link array</q>:
    rather than separate named <code>left</code> and <code>right</code> pointers,
    these two pointers are held in a two-element array,
    addressed respectively as <code>c[0]</code> and <code>c[1]</code>.
    This enables us to parameterize procedures by the index
    where the symmetry of the tree would otherwise demand two symmetrical blocks of code.
  </p>
</section>
  <section xml:base="recursive/recursive.html">
  
  <h3>Recursive <abbr title="Binary Search Tree" class="smallcaps">BST</abbr> algorithms</h3>

  <section>
    <h4><code>rootEq</code></h4>

    <section class="generated_listing" xml:base="../../../code/d/html/bst/rootEq.d.html"><pre class="prettyprint">bool rootEq(Node* root, int value) { </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Function precondition.</div><span class="pred_name">NonEmptyTree</span>(<code>root</code>, <span class="st">S</span>)</div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Open <span class="pred_name">NonEmptyTree</span>(<code>root</code>, <span class="st">S</span>).</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>)</div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Open <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>).</div>∃<span class="var">v</span>, <span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>. <div class="indent">
    <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span> ∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>) ∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>) ∧<br/>
    <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>)
  </div></div></div>
<pre class="prettyprint">
  bool o = root.value == value; </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Assignment.</div>∃<span class="var">v</span>, <span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>. <div class="indent">
    <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span> ∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>) ∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>) ∧<br/>
    <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>) ∧<br/>
    <code>o</code> ↔ <span class="var">v</span> = <code>value</code>
  </div></div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Close <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>). Postcondition.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <code>o</code> ↔ <span class="var">v</span> = <code>value</code></div></div>
<pre class="prettyprint">  return o;
} </pre></section>
  </section>

  <section>
    <h4><code>descend</code>: an algorithm to move down the tree</h4>

    The first algorithm I describe is an auxiliary one that selects a subtree pointer
    depending on a value we are searching for.

    <section class="generated_listing" xml:base="../../../code/d/html/bst/descend.d.html"><pre class="prettyprint">module bst.descend;

import bst.node;


Node* descend(Node* root, in int value) { </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Function precondition.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <span class="var">v</span> ≠ <code>value</code></div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl"><span class="var">a</span> ≠ <span class="var">b</span> ⇒ <span class="var">a</span> &lt; <span class="var">b</span> ∨ <span class="var">b</span> &lt; <span class="var">a</span></div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ (<span class="var">v</span> &lt; <code>value</code>) ∨ (<code>value</code> &lt; <span class="var">v</span>)</div></div>
<pre class="prettyprint">
  int dir = value &gt; root.value;
 </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">C semantics render this as an integer.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <br/><div class="indent">(<span class="var">v</span> &lt; <code>value</code> ∧ <code>dir</code> = <span class="constant">0</span>) ∨ <br/>(<code>value</code> &lt; <span class="var">v</span> ∧ <code>dir</code> = <span class="constant">1</span>)</div></div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Open <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>).</div>∃<span class="var">v</span>, <span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>. <div class="indent">
      <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span> ∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>) ∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>) ∧<br/>
      <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>)
     ∧ <br/><div class="indent">(<span class="var">v</span> &lt; <code>value</code> ∧ <code>dir</code> = <span class="constant">0</span>) ∨ <br/>(<code>value</code> &lt; <span class="var">v</span> ∧ <code>dir</code> = <span class="constant">1</span>)</div></div></div></div>
<pre class="prettyprint">
  Node* o = root.c[dir]; </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Both cases of <code>dir</code>.</div>∃<span class="var">v</span>, <span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>. <div class="indent">
      <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span> ∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>) ∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>) ∧<br/>
      <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>)
     ∧ <br/><div class="indent">(<span class="var">v</span> &lt; <code>value</code> ∧ <code>o</code> = <span class="var">l</span>) ∨ <br/>(<code>value</code> &lt; <span class="var">v</span> ∧ <code>o</code> = <span class="var">r</span>)</div></div></div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Substitution.</div>∃<span class="var">v</span>, <span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>. <div class="indent">
      <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span> ∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>) ∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>) ∧<br/>
      <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>)
     ∧ <br/><div class="indent">(<span class="var">v</span> &lt; <code>value</code> ∧ <span class="pred_name">Tree</span>(<code>o</code>, <span class="st">L</span>)) ∨ <br/>(<code>value</code> &lt; <span class="var">v</span> ∧ <span class="pred_name">Tree</span>(<code>o</code>, <span class="st">R</span>))</div></div></div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Lemma: <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>) ∧ <span class="var">v</span> &lt; <code>value</code> ⇒ <code>value</code> ∈ <span class="st">R</span> ↔ <code>value</code> ∈ <span class="st">S</span>.<br/>
Lemma: <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>) ∧ <code>value</code> &lt; <span class="var">v</span> ⇒ <code>value</code> ∈ <span class="st">L</span> ↔ <code>value</code> ∈ <span class="st">S</span>.</div>∃<span class="var">v</span>, <span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>. <div class="indent">
      <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span> ∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>) ∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>) ∧<br/>
      <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>)
     ∧ <br/><div class="indent">(<span class="pred_name">Tree</span>(<code>o</code>, <span class="st">L</span>) ∧ (<code>value</code> ∈ <span class="st">L</span> ↔ <code>value</code> ∈ <span class="st">S</span>)) ∨ <br/>(<span class="pred_name">Tree</span>(<code>o</code>, <span class="st">R</span>) ∧ (<code>value</code> ∈ <span class="st">R</span> ↔ <code>value</code> ∈ <span class="st">S</span>))</div></div></div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">∃I on <span class="st">L</span> as <span class="st">Q</span>, <span class="st">R</span> as <span class="st">Q</span>.</div>∃<span class="var">v</span>, <span class="var">l</span>,<span class="var">r</span>,<span class="st">L</span>,<span class="st">R</span>. <div class="indent">
      <code>root</code> ↦ <span class="var">v</span>,<span class="var">l</span>,<span class="var">r</span> ∗ <span class="pred_name">Tree</span>(<span class="var">l</span>, <span class="st">L</span>) ∗ <span class="pred_name">Tree</span>(<span class="var">r</span>, <span class="st">R</span>) ∧<br/>
      <span class="pred_name">Compose</span>(<span class="st">L</span>, <span class="var">v</span>, <span class="st">R</span>, <span class="st">S</span>)
     ∧ <br/><div class="indent">∃<span class="st">Q</span>. (<span class="pred_name">Tree</span>(<code>o</code>, <span class="st">Q</span>) ∧ (<code>value</code> ∈ <span class="st">Q</span> ↔ <code>value</code> ∈ <span class="st">S</span>)) ∨ <br/>∃<span class="st">Q</span>. (<span class="pred_name">Tree</span>(<code>o</code>, <span class="st">Q</span>) ∧ (<code>value</code> ∈ <span class="st">Q</span> ↔ <code>value</code> ∈ <span class="st">S</span>))</div></div></div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Introduce quantification.</div>∃v,l,r,L,R.
  root↦v,l,r ∗ Tree(l, L) ∗ Tree(r, R)
  ∧ Compose(L, v, R, S)
  ∧ (∃Q. Tree(o, Q) ∧ (value∈Q ↔ value∈S)) ∨ (∃Q. Tree(o, Q) ∧ (value∈Q ↔ value∈S))</div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">a ∨ a implies a.</div>∃v,l,r,L,R.
  root↦v,l,r ∗ Tree(l, L) ∗ Tree(r, R)
  ∧ Compose(L, v, R, S)
  ∧ ∃Q. Tree(o, Q) ∧ (value∈Q ↔ value∈S))</div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Function postcondition.  Close TopOfTree.</div>TopOfTree(root, v, S)
∧ ∃Q. Tree(o, Q) ∧ (value∈Q ↔ value∈S))</div></div>

<div class="section"><pre class="indent">  </pre><div class="CommentParagraph">Note: we want |Q| &lt; |S|
to show termination of other functions.</div></div>
<pre class="prettyprint">
  return o;
} </pre></section>
  </section>

  <section>
    <h4>Recursive <code>search</code></h4>

    <section class="generated_listing" xml:base="../../../code/d/html/bst/search/recursive.d.html"><pre class="prettyprint">module bst.search.recursive;

import bst.node;
import bst.descend;


bool search(Node* root, in int value) {
  bool o; </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Function precondition.</div><span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>)</div></div>
<pre class="prettyprint">
  if (root) { </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Assert if-condition.</div><span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>) ∧ <code>root</code> ≠ <code>null</code></div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Lemma: <span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>) ∧ <code>root</code> ≠ <code>null</code> ⇒ <span class="pred_name">NonEmptyTree</span>(<code>root</code>, <span class="st">S</span>)</div><span class="pred_name">NonEmptyTree</span>(<code>root</code>, <span class="st">S</span>)</div></div>
<pre class="prettyprint">
    bool eq = rootEq(root, value); </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Specification for <code>rootEq</code>.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <code>eq</code> ↔ <span class="var">v</span> = <code>value</code></div></div>
<pre class="prettyprint">
    if (eq) { </pre>
<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Assert if-test.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <code>eq</code> ↔ <span class="var">v</span> = <code>value</code> ∧ <code>eq</code></div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Use <code>eq</code> ↔ <span class="var">v</span> = <code>value</code>.  Discard <code>eq</code>.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <span class="var">v</span> = <code>value</code></div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Substitution.</div><span class="pred_name">TopOfTree</span>(<code>root</code>, <code>value</code>, <span class="st">S</span>)</div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Lemma: <span class="pred_name">TopOfTree</span>(<code>root</code>, <code>value</code>, <span class="st">S</span>) ⇒ <code>value</code> ∈ <span class="st">S</span></div><span class="pred_name">TopOfTree</span>(<code>root</code>, <code>value</code>, <span class="st">S</span>) ∧ <code>value</code> ∈ <span class="st">S</span></div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Reintroduce ∃I on <code>value</code> as <span class="var">v</span>.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <code>value</code> ∈ <span class="st">S</span></div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Close <span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>).</div><span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>) ∧ <code>value</code> ∈ <span class="st">S</span></div></div>
<pre class="prettyprint">
      o = true; </pre>
<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Assignment.</div><span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>) ∧ <code>value</code> ∈ <span class="st">S</span> ∧ <code>o</code> = <code>true</code></div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">?</div><span class="pred_name">Tree</span>(<code>root</code>, <span class="st">S</span>) ∧ <code>o</code> ↔ <code>value</code> ∈ <span class="st">S</span></div></div>
<pre class="prettyprint">    }
    else { </pre>
<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Deny if-condition.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <code>eq</code> ↔ <span class="var">v</span> = <code>value</code> ∧ ¬<code>eq</code></div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Use <code>eq</code> ↔ <span class="var">v</span> = <code>value</code>.  Discard ¬<code>eq</code>.</div>∃<span class="var">v</span>. <span class="pred_name">TopOfTree</span>(<code>root</code>, <span class="var">v</span>, <span class="st">S</span>) ∧ <span class="var">v</span> ≠ <code>value</code></div></div>
<pre class="prettyprint">
      Node* next = descend(root, value);
 </pre>
<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Specification of <code>descend</code>.</div>TopOfTree(root, v, S) ∧
∃Q. Tree(o, Q) ∧ (value∈Q ↔ value∈S)) ∧ |Q| &lt; |S|</div></div>

<div class="section"><pre class="indent">      </pre><div class="CommentParagraph">Note recursion terminates because |Q| &lt; |S| and |Q| &gt;= 0</div></div>
<pre class="prettyprint">      o = search(next, value);
 </pre>
<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Specification of search.</div>TopOfTree(root, v, S) ∧
∃Q. Tree(o, Q) ∧ (value∈Q ↔ value∈S)) ∧ |Q| &lt; |S| ∧ o ↔ (value ∈ Q)</div></div>

<div class="section"><pre class="indent">      </pre><div class="AssertionParagraph"><div class="expl">Transitivity of ↔; escape ∃; weaken TopOfTree.</div>Tree(root, S) ∧ o ↔ (value ∈ S)</div></div>
<pre class="prettyprint">    } </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Transitivity of both if-branches.</div>Tree(root, S) ∧ o ↔ (value ∈ S)</div></div>
<pre class="prettyprint">  }
  else { </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Deny if-test.</div>Tree(root, S) ∧ root=null</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Null pointer is empty tree (lemma).</div>EmptyTree(root, S)</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Empty tree is empty set (lemma).</div>EmptyTree(root, S) ∧ S = ∅</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Element not in empty set.</div>EmptyTree(root, S) ∧ value ∉ S</div></div>
<pre class="prettyprint">
    o = false;
 </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Assignment.</div>EmptyTree(root, S) ∧ value ∉ S ∧ o = false</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">???</div>EmptyTree(root, S) ∧ o ↔ (value ∈ S)</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Weaken EmptyTree.</div>Tree(root, S) ∧ o ↔ (value ∈ S)</div></div>
<pre class="prettyprint">  } </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Function postcondition.
Postcondition of both if-branches.</div>Tree(root, S) ∧ o ↔ (value ∈ S)</div></div>
<pre class="prettyprint">  return o;
} </pre></section>
  </section>

  <section>
    <h4>Recursive <code>insert</code></h4>

    <section class="generated_listing" xml:base="../../../code/d/html/bst/insert/recursive.d.html"><pre class="prettyprint">module bst.insert.recursive;

import bst.node;

Node* insert(Node* root, int value) {
  Node* o;
  if (!root) {
    o = new Node(value);
  }
  else {
    if (root.value == value) {
      o = root;
    }
    else {
      if (value &lt; root.value) {
	root.c[0] = insert(root.c[0], value);
      }
      else {
	root.c[1] = insert(root.c[1], value);
      }
      o = root;
    }
  }
  return o;
} </pre></section>
  </section>

  <section>
    <h4>Recursive <code>remove</code></h4>

    <p>
      Here's <code>removeMax</code>:

      <section class="generated_listing" xml:base="../../../code/d/html/bst/remove/removeMax/recursive.d.html"><pre class="prettyprint">module bst.remove.removeMax.recursive;


import bst.node;
import bst.remove.removeMax.RemoveMaxRet;

import std.stdio;

RemoveMaxRet removeMax(Node* root) { </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">We can only remove the maximum from a non-empty tree!</div>NonEmptyTree(root, S)</div></div>
<pre class="prettyprint">
  assert(root != null);
 </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Expand NonEmptyTree(root).</div>∃v. TopOfTree(root, v, S).</div></div>

<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Expand TopOfTree(root, v, S).</div>∃v,l,r,L,R.
  root↦v,l,r
  ∗ Tree(l, L)
  ∗ Tree(r, R)
  ∧ Compose(L, v, R, S).</div></div>
<pre class="prettyprint">
  auto r = root.c[1];
 </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Take `r` out of quantification.</div>∃v,l,L,R.
  root↦v,l,r
  ∗ Tree(l, L)
  ∗ Tree(r, R)
  ∧ Compose(L, v, R, S).</div></div>
<pre class="prettyprint">

 </pre>
<div class="section"><pre class="indent">  </pre><div class="CommentParagraph">We're going to put the return values here.</div></div>
<pre class="prettyprint">  int max;
  Node* newRoot;

  if (!r) { </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Assert if-condition.  Discard EmptyTree.</div>∃v,l,L.
  root↦v,l,null
  ∗ Tree(l, L)
  ∧ Compose(L, v, ∅, S).</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Found-max (lemma on Compose).  Discard Compose.</div>∃v,l,L.
  root↦v,l,null
  ∗ Tree(l, L)
  ∧ v∈S ∧ ∀x∈L. x &lt; v ∧ L = S - {v}.</div></div>
<pre class="prettyprint">
    max = root.value;
    newRoot = root.c[0];
 </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Assignment (twice).</div>∃L.
  root↦max,newRoot,null
  ∗ Tree(newRoot, L)
  ∧ max∈S ∧ ∀x∈L. x &lt; max ∧ L = S - {max}.</div></div>
<pre class="prettyprint">
    delete root;
 </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">`root` is dangling.  Rename bound variable.
This gives our function postcondition.</div>∃T.
  Tree(newRoot, T)
  ∧ max∈S ∧ ∀x∈T. x &lt; max ∧ T = S - {max}.</div></div>
<pre class="prettyprint">  }
  else { </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Negate if-condition.</div>∃v,l,L,R.
  root↦v,l,r
  ∗ Tree(l, L)
  ∗ Tree(r, R)
  ∧ Compose(L, v, R, S)
  ∧ r.</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Non-null pointer is non-empty tree (lemma).</div>∃v,l,L,R.
  root↦v,l,r
  ∗ Tree(l, L)
  ∗ NonEmptyTree(r, R)
  ∧ Compose(L, v, R, S).</div></div>
<pre class="prettyprint">
    auto d = removeMax(r);
    auto rightMax = d.max;
    auto rightRoot = d.root;
 </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">removeMax consumes NonEmptyTree(r, R).  `r` is now dangling.</div>∃v,l,L,R,N.
  root↦v,l,r
  ∗ Tree(l, L)
  ∗ Tree(rightRoot, N)
  ∧ Compose(L, v, R, S)
  ∧ rightMax∈R ∧ ∀x∈N. x &lt; rightMax ∧ N = R - {rightMax}.</div></div>
<pre class="prettyprint">
    root.c[1] = rightRoot;
 </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Assignment.</div>∃v,l,L,R,N.
  root↦v,l,rightRoot
  ∗ Tree(l, L)
  ∗ Tree(rightRoot, N)
  ∧ Compose(L, v, R, S)
  ∧ rightMax∈R ∧ ∀x∈N. x &lt; rightMax ∧ N = R - {rightMax}.</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Close TopOfTree.</div>∃v.
  TopOfTree(root, v, S - {rightMax})
  ∧ rightMax∈S ∧ ∀x∈(S-{rightMax}). x &lt; rightMax.</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Introduce quantification on S - {rightMax}.</div>∃v, T.
  TopOfTree(root, v, T)
  ∧ rightMax∈S ∧ ∀x∈T. x &lt; rightMax ∧ T = S - {rightMax}.</div></div>

<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Close NonEmptyTree.</div>∃T.
  NonEmptyTree(root, T)
  ∧ rightMax∈S ∧ ∀x∈T. x &lt; rightMax ∧ T = S - {rightMax}.    </div></div>
<pre class="prettyprint">
    max = rightMax;
    newRoot = root;
 </pre>
<div class="section"><pre class="indent">    </pre><div class="AssertionParagraph"><div class="expl">Assignment.  Gives postcondition.</div>∃T.
  Tree(newRoot, T)
  ∧ max∈S ∧ ∀x∈T. x &lt; max ∧ T = S - {max}.</div></div>
<pre class="prettyprint">  }
 </pre>
<div class="section"><pre class="indent">  </pre><div class="AssertionParagraph"><div class="expl">Postcondition of both if branches.  
Function postcondition.
`max` is the maximum element in `S`,
and `newRoot` represents `S` with `max` subtracted.</div>∃T.
  Tree(newRoot, T)
  ∧ max∈S ∧ ∀x∈T. x &lt; max ∧ T = S - {max}.</div></div>
<pre class="prettyprint">

  RemoveMaxRet o = {max: max, root: newRoot};
  return o;
} </pre></section>
    </p>

    <p>
      Here's <code>removeRoot</code>:

      <section class="generated_listing" xml:base="../../../code/d/html/bst/remove/removeRoot.d.html"><pre class="prettyprint">module bst.removeRoot;

import bst.node;
import bst.remove.removeMax.removeMax;
import bst.remove.removeMax.RemoveMaxRet;


Node* removeRoot(Node* root) {
  assert(root != null);

  if (root.c[0] &amp;&amp; root.c[1]) {
    RemoveMaxRet r = removeMax(root.c[0]);
    root.value = r.max;
    root.c[0] = r.root;
  }
  else {
    assert(!root.c[0] || !root.c[1]);
    Node* rem = root;
    if (root.c[0]) {
      root = root.c[0];
    }
    else {
      root = root.c[1];
    } </pre>
<div class="section"><pre class="indent">    </pre><div class="CommentParagraph">delete rem;</div></div>
<pre class="prettyprint">  }
  return root;
}


unittest {
  auto a = new Node(5);
  a = removeRoot(a);
  assert(a == null);
}


unittest {
  auto a = new Node(5);
  a.c[0] = new Node(4);
  a = removeRoot(a);
  assert(a);
  assert(a.value == 4);
  assert(!a.c[0]);
  assert(!a.c[1]);
}


unittest {
  auto a = new Node(5);
  a.c[0] = new Node(4);
  a.c[1] = new Node(6);
  a = removeRoot(a);

  assert(a);
  assert(a.value == 4);
  assert(a.c[0] == null);
  assert(a.c[1]);
  assert(a.c[1].value == 6);
  assert(!a.c[1].c[0]);
  assert(!a.c[1].c[1]);
} </pre></section>
    </p>

    <p>
      Here's <code>remove</code>:

      <section class="generated_listing" xml:base="../../../code/d/html/bst/remove/recursive.d.html"><pre class="prettyprint">module bst.remove.recursive;

import bst.node;
import bst.remove.removeRoot;


Node* remove(Node* root, int value) {
  Node* o;

  if (!root) {
    o = null;
  }
  else {
    if (value == root.value) {
      o = removeRoot(root);
    }
    else {
      o = root;
      int dir = value &gt; root.value;
      o.c[dir] = remove(o.c[dir], value);
    }
  }

  return o;
} </pre></section>
    </p>
  </section>
</section>
  <!-- <xi:include href="iterative.html" /> -->
</section>
      <!-- <xi:include href="rbt/rbt.html" />
      <xi:include href="concurrent/concurrent.html" /> -->
    </section>
  </body>
</html>
