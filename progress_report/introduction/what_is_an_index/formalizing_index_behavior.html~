<section>
  <h3>An index \API specification</h3>

  <p>
    Specifying an index \ADT is only marginally more complex.
    As with the set$S$, the index $I$ is now purely logical,
    and we can describe it mathematically without concern for memory layout or local variables.
    $I$ is a mapping from a set of keys
    (which is a subset of the universe of keys)
    to a universe of values.
    In other words it is a \NewTerm{finite partial function},
    written as
    $I : \mathsf{Keys} \fpfun \mathsf{Values}$.
  </p>

  <p>
    As $\mathsf{Keys}$ is just a set,
    we can express whether or not a key is in the index
    using ordinary set notation:
    $x \in \KeysOf{I}$ states that
    there is a mapping in the index from $x$ to some value.
    As $I$ is a function,
    we can express a specific mapping
    using ordinary function notation:
    $I(x) = y$ states that
    there is a mapping in the index from $x$ to $y$.
  </p>

  <p>
    With just a couple more shorthand notations,
    we can then express the desired behavior of the index.
    First, the \NewTerm{function update} notation,
    $\fupd{I}{k}{v}$,
    denotes the finite partial function $I$ with the modification that $I(k) = v$.
    Second, the \NewTerm{set difference} notation $I \setminus \Set{k}$
    is a shorthand for $I$ with the removal of the key $k$ from $\KeysOf{I}$.
  </p>

  <p>
    The specification of the desired index behavior follows.
  </p>

  <table>
    <tbody>
      <tr>
	<!-- search where key is in the index -->
	<td>\Cond{\Pred{index}{\IC{i}, I} \Fand I(\IC{k}) = v\prime}</td>
	<td>\IC{v = i->search(k);}</td>
	<td>\Cond{\Pred{index}{\IC{i}, I} \Fand I(\IC{k}) = v\prime \Fand \IC{v} = v\prime}</td>
      </tr>
      <tr>
	<!-- search where key is not in the index -->
	<td>\Cond{\Pred{index}{\IC{i}, I} \Fand \IC{k} \notin \KeysOf{I}}</td>
	<td>\IC{v = i->search(k);}</td>
	<td>\Cond{\Pred{index}{\IC{i}, I} \Fand \IC{k} \notin \KeysOf{I} \Fand \IC{v} = \nullref}</td>
      </tr>
      <tr>
	<!-- insert where key is in the index -->
	<td>\Cond{\Pred{index}{\IC{i}, I} \Fand I(\IC{k}) = v\prime}</td>
	<td>\IC{i->insert(k, v);}</td>
	<td>\Cond{\Pred{index}{\IC{i}, I} \Fand I(\IC{k}) = v\prime}</td>
      </tr>
      <tr>
	<!-- insert where key is not in the index -->
	<td>\Cond{\Pred{index}{\IC{i}, I} \Fand \IC{k} \notin \KeysOf{I}}</td>
	<td>\IC{i->insert(k, v);}</td>
	<td>\Cond{\Pred{index}{\IC{i}, J) \Fand \fupd{I}{\IC{k}}{\IC{v}}}}</td>
      </tr>
      <tr>
	<!-- remove -->
	<td>\Cond{\Pred{index}{\IC{i}, I} }</td>
	<td>\IC{i->remove(k);}</td>
	<td>\Cond{\Pred{index}{\IC{i}, I \setminus \Set{\IC{k}} }}</td>
      </tr>
    </tbody>
  </table>
</section>


